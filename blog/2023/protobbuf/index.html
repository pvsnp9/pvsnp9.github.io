<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Protobuf | Tsuyog Basnet</title> <meta name="author" content="Tsuyog Basnet"> <meta name="description" content="A guide on Protobuf"> <meta name="keywords" content="Machine-Learninng, Data-Scientist, researcher, NLP, personal-blog"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%A0&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://pvsnp9.github.io/blog/2023/protobbuf/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Tsuyog Basnet</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Protobuf</h1> <p class="post-meta">December 31, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/swe"> <i class="fa-solid fa-hashtag fa-sm"></i> swe</a>     ·   <a href="/blog/category/software-engineering"> <i class="fa-solid fa-tag fa-sm"></i> software-engineering</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="introduction">Introduction</h2> <p>Protocol Buffers (protobuf) is a language-agnostic data <code class="language-plaintext highlighter-rouge">byte</code> serialization format developed by Google. It uses a simple language to define data structures in <code class="language-plaintext highlighter-rouge">.proto</code> files. Protobuf supports various data types, including integers, floating-point numbers, booleans, strings, bytes, and custom message types. Messages, the fundamental building blocks, are collections of key-value pairs, akin to objects or structs in programming languages. Additionally, protobuf introduces advanced features such as enumerations, repeated fields, and maps. The format is designed for efficiency, producing compact binary representations of data. Code generators then transform these definitions into source code in different programming languages, allowing seamless data exchange between applications written in diverse languages while providing support for backward and forward compatibility. In addition , gRPC is an open-source RPC framework developed by Google that facilitates efficient, language-agnostic communication between distributed systems using Protocol Buffers</p> <p>In this blog, we’ll delve into the fundamentals of Protocol Buffers and explore the seamless integration of gRPC in the Go programming language, uncovering the power of these tools in enhancing communication and interoperability in modern software architectures.</p> <p>JSON</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Delta"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Special"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rank"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"division"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Air"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Protobuf</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">syntax</span><span class="o">:</span> <span class="s">"proto3"</span><span class="p">;</span>
<span class="k">option</span> <span class="na">go_package</span> <span class="o">=</span><span class="s">"{package_name}/pkg/pb/protogen"</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">basic</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">Officer</span> <span class="p">{</span>
    <span class="kt">uint32</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">int</span> <span class="na">rank</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kt">string</span> <span class="na">division</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">option go_package</code> tells the go package name and detination for proto generated source code.</p> <p>Sidenote: <code class="language-plaintext highlighter-rouge">Marshal</code> refers to the process of converting a data structure into its serialized representation, often in the form of a byte slice or a string. This operation is commonly used for data interchange or storage. Conversely, <code class="language-plaintext highlighter-rouge">Unmarshal</code> involves taking the serialized data and reconstructing the original data structure. These operations are frequently used in encoding and decoding data, such as converting between Go data structures and formats like JSON, XML, or Protocol Buffers. The encoding/json and other related packages in Go provide functions like json.Marshal and json.Unmarshal to perform these operations for JSON encoding and decoding, while similar functions exist for other formats and libraries.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Note: Marshall is serialization and Unmarshall is deserilization. 
</code></pre></div></div> <p>Protobuf is designed with schema evolution in mind to avoid braeaking changes. It needs to follow a certain rules.</p> <p>Protobuf styling Guide<a href="https://github.com/uber/prototool/blob/dev/style/README.md#spacing" rel="external nofollow noopener" target="_blank"> (Uber) </a></p> <h2 id="makefile">Makefile</h2> <div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">GO_MODULE</span> <span class="o">:=</span> github.com/pvsnp9/example


<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">tidy</span>
<span class="nl">tidy</span><span class="o">:</span>
	go mod tidy


<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean</span>
<span class="nl">clean</span><span class="o">:</span>
	<span class="p">@</span><span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"protogen"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">rm</span> <span class="nt">-rf</span> protogen<span class="p">;</span> <span class="k">fi</span>


<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">proto</span>
<span class="nl">proto</span><span class="o">:</span>
	protoc <span class="nt">--go_opt</span><span class="o">=</span><span class="nv">module</span><span class="o">=</span><span class="p">${</span>GO_MODULE<span class="p">}</span> <span class="nt">--go_out</span><span class="o">=</span><span class="nb">.</span> ./pkg/pb/<span class="k">**</span>/<span class="k">*</span>.proto


<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">build</span>
<span class="nl">build</span><span class="o">:</span> <span class="nf">clean protoc tidy</span>


<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">run</span>
<span class="nl">run</span><span class="o">:</span>
	go run cmd/main.go


</code></pre></div></div> <p>When you use the Protocol Buffers compiler (<code class="language-plaintext highlighter-rouge">protoc</code>) to generate code for a proto file, it typically produces files with certain naming conventions based on the target language and the type of service definition. Here are the meanings of the files you mentioned:</p> <ol> <li> <strong><code class="language-plaintext highlighter-rouge">*.pb.go</code> Files:</strong> <ul> <li>These are Go source files generated by the <code class="language-plaintext highlighter-rouge">protoc</code> compiler when targeting Go (Golang).</li> <li>The <code class="language-plaintext highlighter-rouge">*.pb.go</code> files contain the generated code for your protocol buffer messages, allowing you to easily serialize and deserialize data structures defined in your proto file.</li> <li>The file name is typically derived from your original proto file. For example, if your proto file is named <code class="language-plaintext highlighter-rouge">example.proto</code>, the generated Go file might be named <code class="language-plaintext highlighter-rouge">example.pb.go</code>.</li> </ul> </li> <li> <strong><code class="language-plaintext highlighter-rouge">*_grpc.pb.go</code> Files:</strong> <ul> <li>When you define a gRPC service in your proto file, the <code class="language-plaintext highlighter-rouge">protoc</code> compiler generates additional code for the service implementation and client in addition to the message types.</li> <li>The <code class="language-plaintext highlighter-rouge">*_grpc.pb.go</code> file contains the gRPC service interface and the server-side implementation code.</li> <li>The naming convention usually involves adding <code class="language-plaintext highlighter-rouge">_grpc.pb.go</code> to the base name of your proto file. For example, if your proto file is named <code class="language-plaintext highlighter-rouge">example.proto</code>, the generated gRPC file might be named <code class="language-plaintext highlighter-rouge">example_grpc.pb.go</code>.</li> </ul> </li> </ol> <p>Here’s a quick example to illustrate the naming conventions:</p> <ul> <li>Original Proto File: <code class="language-plaintext highlighter-rouge">example.proto</code> </li> <li>Generated Go File for Messages: <code class="language-plaintext highlighter-rouge">example.pb.go</code> </li> <li>Generated Go File for gRPC Service: <code class="language-plaintext highlighter-rouge">example_grpc.pb.go</code> </li> </ul> <p>These files, once generated, allow you to work with your protocol buffer messages and gRPC service in your Go application. Remember that the actual names may depend on your specific proto file and project structure.</p> <h2 id="repeated-fields-enumeration-comments">Repeated fields, enumeration, Comments</h2> <p>Repeated : A filed with one or zero values like a array/list. The default value is empty.</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="k">repeated</span> <span class="n">int</span> <span class="n">itemId</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="n">Gender</span> <span class="p">{</span>
    <span class="na">GENDER_UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">GENDER_MALE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="na">GENDER_FEMALE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>How to use them:</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">User</span> <span class="p">{</span>
  <span class="kt">uint32</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">username</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">is_active</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">emails</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">Gender</span> <span class="na">gender</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="nested-message-type">Nested message type</h2> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Define another message called "Address"</span>
<span class="kd">message</span> <span class="nc">Address</span> <span class="p">{</span>
  <span class="c1">// Define fields for the Address message</span>
  <span class="kt">string</span> <span class="na">street</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">city</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">country</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">postal_code</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">Coordinate</span> <span class="na">coordinate</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="c1">//field to access the cordindate </span>

  <span class="c1">// nested</span>
  <span class="kd">message</span> <span class="nc">Coordinate</span> <span class="p">{</span>
      <span class="kt">double</span> <span class="na">lattitude</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kt">double</span> <span class="na">longitude</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//Using it </span>
<span class="n">address</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Address</span><span class="p">{</span>
    <span class="n">Street</span><span class="o">:</span>     <span class="s">"Street"</span><span class="p">,</span>
    <span class="n">City</span><span class="o">:</span>       <span class="s">"City"</span><span class="p">,</span>
    <span class="n">PostalCode</span><span class="o">:</span> <span class="s">"PSTCD3"</span><span class="p">,</span>
    <span class="n">Coordinate</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">basic</span><span class="o">.</span><span class="n">Address_Coordinate</span><span class="p">{</span>
        <span class="n">Lattitude</span><span class="o">:</span> <span class="m">40.705152254</span><span class="p">,</span>
        <span class="n">Longitude</span><span class="o">:</span> <span class="o">-</span><span class="m">74.52515425</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">}</span>

</code></pre></div></div> <p>##ProtoJSON</p> <p>a tool to convert JSON to protobuf and vice-versa.</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">import</span> <span class="p">(</span>
	<span class="s">"log"</span>
	<span class="s">"github.com/pvsnp9/example/pkg/protogen/basic"</span>
	<span class="s">"google.golang.org/protobuf/encoding/protojson"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">ProtoToJsonUser</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">u</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">User</span><span class="p">{</span>
		<span class="n">Id</span><span class="o">:</span>       <span class="m">2</span><span class="p">,</span>
		<span class="n">Username</span><span class="o">:</span> <span class="s">"Bravo"</span><span class="p">,</span>
		<span class="n">IsActive</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
		<span class="n">Password</span><span class="o">:</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"adfasfas"</span><span class="p">),</span>
		<span class="n">Emails</span><span class="o">:</span>   <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"test@mai.com"</span><span class="p">,</span> <span class="s">"test2@mail.com"</span><span class="p">},</span>
		<span class="n">Gender</span><span class="o">:</span>   <span class="n">basic</span><span class="o">.</span><span class="n">Gender_GENDER_MALE</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">jsonBytes</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"error"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">jsonBytes</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">JsonToProto</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">json</span> <span class="o">:=</span> <span class="s">`{
		"id": 5,
		"username":"delta",
		"is_active":true,
		"password":"YWRmYXNmYXM=",
		"emails":["test@mai.com", "test2@mail.com"],
		"gender":"GENDER_MALE"
	}`</span>

	<span class="k">var</span> <span class="n">user</span> <span class="n">basic</span><span class="o">.</span><span class="n">User</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">json</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">user</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Err:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span>


</code></pre></div></div> <h2 id="importing-protos">Importing Protos</h2> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"pkg/pb/basic/user.proto"</span><span class="p">;</span>
<span class="c1">// package_name/yoo=ur_directory</span>

<span class="kn">package</span> <span class="nn">basic</span><span class="p">;</span>

<span class="k">option</span> <span class="na">go_package</span> <span class="o">=</span> <span class="s">"github.com/pvsnp9/example/pkg/protogen/basic"</span><span class="p">;</span>
<span class="c1">// package_name/generated file destiantion</span>

<span class="kd">message</span> <span class="nc">UserGroup</span> <span class="p">{</span>
    <span class="kt">int32</span> <span class="na">group_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span><span class="o">=</span><span class="s">"group_id"</span><span class="p">];</span>
    <span class="kt">string</span> <span class="na">group_name</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="na">json_name</span><span class="o">=</span><span class="s">"group_name"</span><span class="p">];</span>
    <span class="k">repeated</span> <span class="kt">string</span> <span class="na">roles</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">repeated</span> <span class="n">User</span> <span class="na">user</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="kt">string</span> <span class="na">description</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div> <p>Importing non-local protos.</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"pkg/pb/basic/application.proto"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"pkg/pb/dummy/application.proto"</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">jobsearch</span><span class="p">;</span>

<span class="k">option</span> <span class="na">go_package</span> <span class="o">=</span> <span class="s">"github.com/pvsnp9/example/pkg/protogen/jobsearch"</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">JobCandidate</span> <span class="p">{</span>
    <span class="kt">uint32</span> <span class="na">job_candidate_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"job_candidate_id"</span><span class="p">];</span>
    <span class="n">dummy.Application</span> <span class="na">application</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">message</span> <span class="nc">JobSoftware</span> <span class="p">{</span>
    <span class="kt">uint32</span> <span class="na">job_software_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"job_software_id"</span><span class="p">];</span>
    <span class="n">basic.Application</span> <span class="na">application</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>

</code></pre></div></div> <h2 id="any">Any</h2> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">message</span> <span class="nc">Papermail</span><span class="p">{</span>
    <span class="kt">string</span> <span class="na">paper_mail_address</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"paper_mail_address"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">message</span> <span class="nc">SocialMedia</span><span class="p">{</span>
    <span class="kt">string</span> <span class="na">social_media_platform</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"social_media_platform"</span><span class="p">];</span>
    <span class="kt">string</span> <span class="na">social_media_username</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"social_media_username"</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">message</span> <span class="nc">InstantMessaging</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="na">instant_messaging_product</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"instant_messaging_product"</span><span class="p">];</span>
    <span class="kt">string</span> <span class="na">instant_messaging_username</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"instant_messaging_username"</span><span class="p">];</span>
  <span class="p">}</span>
</code></pre></div></div> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//usage </span>
<span class="kd">message</span> <span class="nc">User</span> <span class="p">{</span>
     <span class="n">google.protobuf.Any</span> <span class="na">communication_channel</span> <span class="o">=</span> <span class="mi">19</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"communication_channel"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//examples </span>
<span class="k">func</span> <span class="n">randomCommunicationChanel</span><span class="p">()</span> <span class="n">anypb</span><span class="o">.</span><span class="n">Any</span> <span class="p">{</span>
	<span class="n">paper_mail</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Papermail</span><span class="p">{</span>
		<span class="n">PaperMailAddress</span><span class="o">:</span> <span class="s">"Mailing address !!"</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">social_media</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">SocialMedia</span><span class="p">{</span>
		<span class="n">SocialMediaPlatform</span><span class="o">:</span> <span class="s">"insta"</span><span class="p">,</span>
		<span class="n">SocialMediaUsername</span><span class="o">:</span> <span class="s">"rango"</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="n">instant_messaging</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">InstantMessaging</span><span class="p">{</span>
		<span class="n">InstantMessagingProduct</span><span class="o">:</span>  <span class="s">"whatsapp"</span><span class="p">,</span>
		<span class="n">InstantMessagingUsername</span><span class="o">:</span> <span class="s">"Rango"</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="k">var</span> <span class="n">any</span> <span class="n">anypb</span><span class="o">.</span><span class="n">Any</span>

	<span class="k">switch</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="m">20</span><span class="p">)</span> <span class="o">%</span> <span class="m">3</span><span class="p">;</span> <span class="n">r</span> <span class="p">{</span>
	<span class="k">case</span> <span class="m">0</span><span class="o">:</span>
		<span class="n">anypb</span><span class="o">.</span><span class="n">MarshalFrom</span><span class="p">(</span><span class="o">&amp;</span><span class="n">any</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">paper_mail</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">MarshalOptions</span><span class="p">{})</span>
	<span class="k">case</span> <span class="m">1</span><span class="o">:</span>
		<span class="n">anypb</span><span class="o">.</span><span class="n">MarshalFrom</span><span class="p">(</span><span class="o">&amp;</span><span class="n">any</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">social_media</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">MarshalOptions</span><span class="p">{})</span>
	<span class="k">default</span><span class="o">:</span>
		<span class="n">anypb</span><span class="o">.</span><span class="n">MarshalFrom</span><span class="p">(</span><span class="o">&amp;</span><span class="n">any</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">instant_messaging</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">MarshalOptions</span><span class="p">{})</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">any</span>
<span class="p">}</span>

<span class="c">// if we know which message type it is.</span>
<span class="k">func</span> <span class="n">BasicUnMarshallAnyToKnown</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">sm</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">SocialMedia</span><span class="p">{</span>
		<span class="n">SocialMediaPlatform</span><span class="o">:</span> <span class="s">"Fb"</span><span class="p">,</span>
		<span class="n">SocialMediaUsername</span><span class="o">:</span> <span class="s">"tt"</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="k">var</span> <span class="n">a</span> <span class="n">anypb</span><span class="o">.</span><span class="n">Any</span>
	<span class="n">anypb</span><span class="o">.</span><span class="n">MarshalFrom</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sm</span><span class="p">,</span> <span class="n">proto</span><span class="o">.</span><span class="n">MarshalOptions</span><span class="p">{})</span>
	<span class="n">smedia</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">SocialMedia</span><span class="p">{}</span>

	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">UnmarshalTo</span><span class="p">(</span><span class="o">&amp;</span><span class="n">smedia</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">json</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sm</span><span class="p">)</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
<span class="p">}</span>

<span class="c">//if we do not know message type</span>
<span class="k">func</span> <span class="n">BasicUnMarshallAnyToUnknown</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">anon</span> <span class="o">:=</span> <span class="n">randomCommunicationChanel</span><span class="p">()</span>

	<span class="k">var</span> <span class="n">anonUnmarshalled</span> <span class="n">protoreflect</span><span class="o">.</span><span class="n">ProtoMessage</span>

	<span class="n">anonUnmarshalled</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">anon</span><span class="o">.</span><span class="n">UnmarshalNew</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Unmarshall as a "</span><span class="p">,</span> <span class="n">anonUnmarshalled</span><span class="o">.</span><span class="n">ProtoReflect</span><span class="p">()</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">()</span><span class="o">.</span><span class="n">Name</span><span class="p">())</span>
	<span class="n">json</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">anonUnmarshalled</span><span class="p">)</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
<span class="p">}</span>


</code></pre></div></div> <h2 id="oneof">Oneof</h2> <p>Allow only X, Y, or custom_filed. It uses $oneof$ keyword to define.</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">User</span> <span class="p">{</span>
    <span class="k">oneof</span> <span class="n">electronic_comm_channel</span> <span class="p">{</span>
        <span class="n">SocialMedia</span> <span class="na">social_media</span> <span class="o">=</span> <span class="mi">20</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"social_media"</span><span class="p">];</span>
        <span class="n">InstantMessaging</span> <span class="na">instant_messaging</span> <span class="o">=</span> <span class="mi">21</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"instant_messaging"</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// oneof example</span>
<span class="k">func</span> <span class="n">BasicOneof</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">sm</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">SocialMedia</span><span class="p">{</span>
		<span class="n">SocialMediaPlatform</span><span class="o">:</span> <span class="s">"X"</span><span class="p">,</span>
		<span class="n">SocialMediaUsername</span><span class="o">:</span> <span class="s">"Charlie"</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="n">ecom_chan</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">User_SocialMedia</span><span class="p">{</span>
		<span class="n">SocialMedia</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">sm</span><span class="p">,</span>
	<span class="p">}</span>

	<span class="n">user</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">User</span><span class="p">{</span>
		<span class="n">Id</span><span class="o">:</span>                    <span class="m">11</span><span class="p">,</span>
		<span class="n">Username</span><span class="o">:</span>              <span class="s">"LaLa"</span><span class="p">,</span>
		<span class="n">IsActive</span><span class="o">:</span>              <span class="no">true</span><span class="p">,</span>
		<span class="n">Password</span><span class="o">:</span>              <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Rango"</span><span class="p">),</span>
		<span class="n">Gender</span><span class="o">:</span>                <span class="n">basic</span><span class="o">.</span><span class="n">Gender_GENDER_MALE</span><span class="p">,</span>
		<span class="n">Emails</span><span class="o">:</span>                <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"test@mai.com"</span><span class="p">,</span> <span class="s">"test2@mail.com"</span><span class="p">},</span>
		<span class="n">ElectronicCommChannel</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">ecom_chan</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="n">json</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">)</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="map">Map</h2> <p>Its a key-value data structure. Protobuf also supports map data structure.</p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">User</span> <span class="p">{</span>
    <span class="n">map</span> <span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">uint32</span><span class="err">&gt;</span> <span class="na">skill_rating</span> <span class="o">=</span> <span class="mi">22</span> <span class="p">[</span><span class="na">json_name</span><span class="o">=</span><span class="s">"skill_rating"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">skill_rating</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">uint32</span><span class="p">{</span><span class="s">"swim"</span><span class="o">:</span> <span class="m">8</span><span class="p">,</span> <span class="s">"fly"</span><span class="o">:</span> <span class="m">9</span><span class="p">,</span> <span class="s">"drive"</span><span class="o">:</span> <span class="m">10</span><span class="p">}</span>
<span class="n">user</span> <span class="o">:=</span> <span class="n">User</span><span class="p">{</span>
    <span class="n">SkillRating</span><span class="o">:</span> <span class="n">skill_rating</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="readwrite-to-disk">Read/Write to Disk</h2> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="c">// write to file</span>
<span class="k">func</span> <span class="n">WriteUserToFile</span><span class="p">(</span><span class="n">user</span> <span class="n">proto</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">bytes</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">proto</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bytes</span><span class="p">,</span> <span class="m">0644</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s">"Error writing to file"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"writing to file completed"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">//Reading from file</span>
<span class="k">func</span> <span class="n">ReadUserFromDisk</span><span class="p">(</span><span class="n">dest</span> <span class="n">proto</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>

	<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Reading file "</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
	<span class="n">bytes</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s">"Errot reading file"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="c">// var user basic.User</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">proto</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="n">dest</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s">"Error on unmarshalling user"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">json</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="readwrite-as-json">Read/Write as JSON</h2> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">//write as a json</span>
<span class="k">func</span> <span class="n">WriteAsJson</span><span class="p">(</span><span class="n">msg</span> <span class="n">proto</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">jsonBytes</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">jsonBytes</span><span class="p">,</span> <span class="m">0644</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s">"could not write to file "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s">"Writing file is completed."</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">//read as jsom and print</span>
<span class="k">func</span> <span class="n">ReadAsJson</span><span class="p">(</span><span class="n">dest</span> <span class="n">proto</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">filename</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">bytes</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s">"Could not read file "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="n">dest</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s">"Unmarshalling failed "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="p">}</span>
	<span class="n">json</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">protojson</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
	<span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="kt">string</span><span class="p">(</span><span class="n">json</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="schema-evolution">Schema Evolution</h2> <p>it is to gracefully adapt to changes in the structure of serialized data over time, enabling compatibility and interoperability between different versions of the schema.</p> <ul> <li>Compatibility: sender and receiver might have different protobuf message definition</li> <li>Forward &amp; Backward compatibility</li> </ul> <p><code class="language-plaintext highlighter-rouge">Rules</code></p> <ul> <li>Do not change field number <code class="language-plaintext highlighter-rouge">message A { string email = 1;}</code> but, renaming is allowed because the serialization and deserialization depends on number.</li> <li>Removing fields is okay but must not be used in future. The field number and field names are better reserved. <code class="language-plaintext highlighter-rouge">message A { reserved 3; reserved "phone_number"; reserved 3 to 5; reserved 'x', 'y';}</code> </li> <li>During deletion, be aware of the fact old and new binary will have differences.</li> </ul> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">message</span> <span class="nc">UserContent</span> <span class="p">{</span>
  <span class="kt">uint32</span> <span class="na">user_content_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"user_content_id"</span><span class="p">];</span>
  <span class="kt">string</span> <span class="na">slug</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">title</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">html_content</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"html_content"</span><span class="p">];</span>
  <span class="kt">uint32</span> <span class="na">author_id</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"author_id"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//read and write content in v1 </span>
<span class="n">user_content</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">UserContent</span><span class="p">{</span>
<span class="n">UserContentId</span><span class="o">:</span> <span class="m">12</span><span class="p">,</span>
    <span class="n">Slug</span><span class="o">:</span>          <span class="s">"slug12"</span><span class="p">,</span>
    <span class="n">Title</span><span class="o">:</span>         <span class="s">"Test content"</span><span class="p">,</span>
    <span class="n">HtmlContent</span><span class="o">:</span>   <span class="s">"&lt;h1&gt;Heading 1&lt;/h1&gt;"</span><span class="p">,</span>
    <span class="n">AuthorId</span><span class="o">:</span>      <span class="m">32</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">var</span> <span class="n">dest</span> <span class="n">basic</span><span class="o">.</span><span class="n">UserContent</span>

<span class="n">services</span><span class="o">.</span><span class="n">WriteUserToFile</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user_content</span><span class="p">,</span> <span class="s">"user_content_v1.bin"</span><span class="p">)</span>
<span class="n">services</span><span class="o">.</span><span class="n">ReadUserFromDisk</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dest</span><span class="p">,</span> <span class="s">"user_content_v1.bin"</span><span class="p">)</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">update the message UserContent add new field category</code></p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">message</span> <span class="nc">UserContent</span> <span class="p">{</span>
  <span class="kt">uint32</span> <span class="na">user_content_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"user_content_id"</span><span class="p">];</span>
  <span class="kt">string</span> <span class="na">slug</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">title</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">html_content</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"html_content"</span><span class="p">];</span>
  <span class="kt">uint32</span> <span class="na">author_id</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"author_id"</span><span class="p">];</span>
  <span class="kt">string</span> <span class="na">category</span> <span class="o">=</span> <span class="mi">6</span> <span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Forward compatibility</p> <ul> <li>Read <code class="language-plaintext highlighter-rouge">user_content_v1.bin</code> using UserContent version 2 (writer is older / forward compatibility)</li> <li>Write user_content_v2.bin using UserContent version 2</li> <li>Read user_content_v2.bin using UserContent version 2</li> </ul> <p><code class="language-plaintext highlighter-rouge">update the message UserContent to following</code></p> <div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">UserContent</span> <span class="p">{</span>
  <span class="n">reserved</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">;</span>
  <span class="kt">uint32</span> <span class="na">user_content_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"user_content_id"</span><span class="p">];</span>
  <span class="kt">string</span> <span class="na">slug</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">// string title = 3;</span>
  <span class="kt">string</span> <span class="na">html_content</span> <span class="o">=</span> <span class="mi">4</span> <span class="p">[</span><span class="na">json_name</span> <span class="o">=</span> <span class="s">"html_content"</span><span class="p">];</span>
  <span class="c1">// uint32 author_id = 5 [json_name = "author_id"];</span>
  <span class="kt">string</span> <span class="na">category</span> <span class="o">=</span> <span class="mi">6</span> <span class="p">;</span>
  <span class="kt">string</span> <span class="na">sub_category</span> <span class="o">=</span> <span class="mi">7</span> <span class="p">[</span><span class="na">json_name</span><span class="o">=</span><span class="s">"sub_category"</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">//readung and writing in V3</span>
<span class="n">user_content</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">UserContent</span><span class="p">{</span>
    <span class="n">UserContentId</span><span class="o">:</span> <span class="m">12</span><span class="p">,</span>
    <span class="n">Slug</span><span class="o">:</span>          <span class="s">"slug12"</span><span class="p">,</span>
    <span class="n">HtmlContent</span><span class="o">:</span>   <span class="s">"&lt;h1&gt;Heading 1&lt;/h1&gt;"</span><span class="p">,</span>
    <span class="n">Category</span><span class="o">:</span>      <span class="s">"S"</span><span class="p">,</span>
    <span class="n">SubCategory</span><span class="o">:</span>   <span class="s">"AA"</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">var</span> <span class="n">dest</span> <span class="n">basic</span><span class="o">.</span><span class="n">UserContent</span>

<span class="n">services</span><span class="o">.</span><span class="n">WriteUserToFile</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user_content</span><span class="p">,</span> <span class="s">"user_content_v3.bin"</span><span class="p">)</span>
<span class="n">services</span><span class="o">.</span><span class="n">ReadUserFromDisk</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dest</span><span class="p">,</span> <span class="s">"user_content_v3.bin"</span><span class="p">)</span>
</code></pre></div></div> <h2 id="additional-types">Additional types</h2> <p>Download types from following links, and place them into your directory. <a href="https://protobuf.dev/reference/protobuf/google.protobuf/" rel="external nofollow noopener" target="_blank"> Documentation</a> <a href="https://github.com/googleapis/googleapis/tree/master/google/type" rel="external nofollow noopener" target="_blank">Source files</a></p> <p>Example: <code class="language-plaintext highlighter-rouge">pkg/ pb/ google/ types/ g.proto </code></p> <p>import</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"pkg/pb/google/type/date.proto"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"pkg/pb/google/type/latlng.proto"</span><span class="p">;</span>

<span class="n">message</span> <span class="n">User</span> <span class="p">{</span>
    <span class="n">google</span><span class="o">.</span><span class="k">type</span><span class="o">.</span><span class="n">Date</span> <span class="n">birth_date</span>  <span class="o">=</span> <span class="m">24</span> <span class="p">[</span><span class="n">json_name</span> <span class="o">=</span> <span class="s">"birth_date"</span><span class="p">];</span>
    <span class="n">google</span><span class="o">.</span><span class="k">type</span><span class="o">.</span><span class="n">LatLng</span> <span class="n">last_known_location</span> <span class="o">=</span> <span class="m">25</span> <span class="p">[</span><span class="n">json_name</span> <span class="o">=</span> <span class="s">"last_known_location"</span><span class="p">];</span>
<span class="p">}</span>

<span class="c">//usage</span>
<span class="n">user</span> <span class="o">:=</span> <span class="n">basic</span><span class="o">.</span><span class="n">User</span><span class="p">{</span>
    <span class="n">Id</span><span class="o">:</span>                    <span class="m">11</span><span class="p">,</span>
    <span class="n">Username</span><span class="o">:</span>              <span class="s">"LaLa"</span><span class="p">,</span>
    <span class="n">SkillRating</span><span class="o">:</span>           <span class="n">skill_rating</span><span class="p">,</span>
    <span class="n">LastLogin</span><span class="o">:</span>             <span class="n">timestamppb</span><span class="o">.</span><span class="n">Now</span><span class="p">(),</span>
    <span class="n">BirthDate</span><span class="o">:</span>             <span class="o">&amp;</span><span class="n">date</span><span class="o">.</span><span class="n">Date</span><span class="p">{</span><span class="n">Year</span><span class="o">:</span> <span class="m">2000</span><span class="p">,</span> <span class="n">Month</span><span class="o">:</span> <span class="m">5</span><span class="p">,</span> <span class="n">Day</span><span class="o">:</span> <span class="m">27</span><span class="p">},</span>
    <span class="n">LastKnownLocation</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">latlng</span><span class="o">.</span><span class="n">LatLng</span><span class="p">{</span>
        <span class="n">Latitude</span><span class="o">:</span>  <span class="o">-</span><span class="m">6.29847717</span><span class="p">,</span>
        <span class="n">Longitude</span><span class="o">:</span> <span class="m">106.8290577</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="validate"><a href="https://github.com/bufbuild/protoc-gen-validate" rel="external nofollow noopener" target="_blank">Validate</a></h2> <p>Comming soon !!</p> </div> </article> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Tsuyog Basnet. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: April 13, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>